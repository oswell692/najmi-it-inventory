 {% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>{{ station.name if station else "Station Dashboard" }} - Dashboard</h2>
    <p class="text-muted">{{ station.location if station else "" }}</p>

    <p class="text-end">
    {% if session.role == 'admin' %}
        <a href="{{ url_for('admin.admin_dashboard') }}" class="btn btn-secondary btn-sm">‚ÜêDashboard</a>
    {% endif %}
</p>

    <!-- Small Counter Cards (ADDED) -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card mb-3 border-primary">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 text-muted">Computers</h6>
                            <h4 class="mb-0 text-primary">{{ computers|length if computers else 0 }}</h4>
                        </div>
                        <i class="fas fa-desktop text-primary fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3 border-success">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 text-muted">Printers</h6>
                            <h4 class="mb-0 text-success">{{ printers|length if printers else 0 }}</h4>
                        </div>
                        <i class="fas fa-print text-success fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card mb-3 border-info">
                <div class="card-body p-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="card-title mb-0 text-muted">Routers</h6>
                            <h4 class="mb-0 text-info">{{ routers|length if routers else 0 }}</h4>
                        </div>
                        <i class="fas fa-wifi text-info fa-lg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabs for Computers, Printers & Routers (EXACTLY AS YOU HAD THEM - NO COUNTERS) -->
    <ul class="nav nav-tabs mb-3" id="stationTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="computers-tab" data-bs-toggle="tab" data-bs-target="#computers" type="button" role="tab" aria-controls="computers" aria-selected="true">
                <i class="fas fa-desktop me-1"></i>
                Computers
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="printers-tab" data-bs-toggle="tab" data-bs-target="#printers" type="button" role="tab" aria-controls="printers" aria-selected="false">
                <i class="fas fa-print me-1"></i>
                Printers
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="routers-tab" data-bs-toggle="tab" data-bs-target="#routers" type="button" role="tab" aria-controls="routers" aria-selected="false">
                <i class="fas fa-wifi me-1"></i>
                Routers
            </button>
        </li>
    </ul>

    <div class="tab-content" id="stationTabsContent">
        <!-- COMPUTERS TAB (EXACTLY AS YOU HAD IT) -->
        <div class="tab-pane fade show active" id="computers" role="tabpanel" aria-labelledby="computers-tab">
            <div class="d-flex justify-content-between mb-2">
                <h5>All Computers</h5>
                {% if station %}
                    {% if session.role == 'user' %}
                        <a href="{{ url_for('user.add_computer', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Computer
                        </a>
                    {% elif session.role == 'admin' %}
                        <a href="{{ url_for('admin.add_computer', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Computer
                        </a>
                    {% endif %}
                {% endif %}
            </div>

            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Computer Name</th>
                        <th>Assigned User</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for comp in computers %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ comp.name }}</td>
                        <td>{{ comp.assigned_user }}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                {% if session.role == 'user' %}
                                    <a href="{{ url_for('user.view_computer', equipment_id=comp.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('user.edit_computer', equipment_id=comp.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('user.delete_equipment', equipment_id=comp.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% elif session.role == 'admin' %}
                                    <a href="{{ url_for('admin.view_computer', equipment_id=comp.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('admin.edit_computer', equipment_id=comp.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('admin.delete_equipment', equipment_id=comp.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- PRINTERS TAB (EXACTLY AS YOU HAD IT) -->
        <div class="tab-pane fade" id="printers" role="tabpanel" aria-labelledby="printers-tab">
            <div class="d-flex justify-content-between mb-2">
                <h5>All Printers</h5>
                {% if station %}
                    {% if session.role == 'user' %}
                        <a href="{{ url_for('user.add_printer', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Printer
                        </a>
                    {% elif session.role == 'admin' %}
                        <a href="{{ url_for('admin.add_printer', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Printer
                        </a>
                    {% endif %}
                {% endif %}
            </div>

            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Printer Name</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for printer in printers %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ printer.name }}</td>
                        <td>{{ printer.status }}</td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                {% if session.role == 'user' %}
                                    <a href="{{ url_for('user.view_printer', equipment_id=printer.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('user.edit_printer', equipment_id=printer.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('user.delete_equipment', equipment_id=printer.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% elif session.role == 'admin' %}
                                    <a href="{{ url_for('admin.view_printer', equipment_id=printer.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('admin.edit_printer', equipment_id=printer.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('admin.delete_equipment', equipment_id=printer.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- ROUTERS TAB (EXACTLY AS YOU HAD IT) -->
        <div class="tab-pane fade" id="routers" role="tabpanel" aria-labelledby="routers-tab">
            <div class="d-flex justify-content-between mb-2">
                <h5>All Routers</h5>
                {% if station %}
                    {% if session.role == 'user' %}
                        <a href="{{ url_for('user.add_router', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Router
                        </a>
                    {% elif session.role == 'admin' %}
                        <a href="{{ url_for('admin.add_router', station_id=station['id']) }}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Router
                        </a>
                    {% endif %}
                {% endif %}
            </div>

            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Router Name</th>
                        <th>IP Address</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for router in routers %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ router.name }}</td>
                        <td>
                            {% if router.ip_address %}
                                <code>{{ router.ip_address }}</code>
                            {% else %}
                                <span class="text-muted">Not set</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if router.status == 'active' %}
                                <span class="badge bg-success">Active</span>
                            {% elif router.status == 'maintenance' %}
                                <span class="badge bg-warning">Maintenance</span>
                            {% elif router.status == 'offline' %}
                                <span class="badge bg-danger">Offline</span>
                            {% elif router.status == 'backup' %}
                                <span class="badge bg-secondary">Backup</span>
                            {% else %}
                                <span class="badge bg-light text-dark">{{ router.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                {% if session.role == 'user' %}
                                    <a href="{{ url_for('user.view_router', equipment_id=router.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('user.edit_router', equipment_id=router.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('user.delete_equipment', equipment_id=router.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% elif session.role == 'admin' %}
                                    <a href="{{ url_for('admin.view_router', router_id=router.id) }}" class="btn btn-outline-info" title="View">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('admin.edit_router', router_id=router.id) }}" class="btn btn-outline-warning" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form action="{{ url_for('admin.delete_router', router_id=router.id) }}" method="POST" style="display:inline-block;">
                                        <button type="submit" class="btn btn-outline-danger" title="Delete" onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    /* Your original tab styling EXACTLY as you had it */
    /* Ensure tabs are visible and clickable */
    .nav-tabs {
        border-bottom: 2px solid #dee2e6;
        background-color: #f8f9fa;
        padding: 0.5rem;
        border-radius: 8px;
    }
    
    .nav-tabs .nav-link {
        border: 1px solid #dee2e6;  /* Added border for all tabs */
        border-radius: 6px;
        padding: 0.75rem 1.25rem;
        color: #000;  /* Pure black for maximum visibility */
        font-weight: 600;  /* Bolder font */
        transition: all 0.2s;
        margin-right: 0.5rem;
        background-color: #f8f9fa;  /* Light gray background for inactive tabs */
    }
    
    .nav-tabs .nav-link:hover {
        border-color: #adb5bd;
        background-color: #e9ecef;  /* Slightly darker on hover */
        transform: translateY(-2px);
        color: #000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .nav-tabs .nav-link.active {
        color: #fff;  /* White text */
        background-color: #0d6efd;  /* Blue background for active tab */
        border-color: #0d6efd;
        box-shadow: 0 2px 8px rgba(13, 110, 253, 0.3);
        position: relative;
    }
    
    .nav-tabs .nav-link.active::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        right: 0;
        height: 3px;
        background: #0a58ca;
        border-radius: 3px 3px 0 0;
    }
    
    /* Make tab content clearly visible */
    .tab-content {
        background-color: white;
        border: 1px solid #dee2e6;
        border-top: none;
        border-radius: 0 0 8px 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }
    
    /* Ensure buttons in tables are visible */
    .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    
    /* Badge styling */
    .badge {
        font-size: 0.75em;
        padding: 0.25em 0.6em;
        vertical-align: middle;
    }
    
    /* Force tab visibility - override everything else */
    #stationTabs .nav-link {
        color: #000000 !important;  /* Black */
        background-color: #f8f9fa !important;  /* Light gray */
        border: 1px solid #ced4da !important;
        opacity: 1 !important;
        visibility: visible !important;
    }
    
    #stationTabs .nav-link:hover {
        background-color: #e9ecef !important;
    }
    
    #stationTabs .nav-link.active {
        color: #ffffff !important;  /* White */
        background-color: #0d6efd !important;  /* Blue */
        border-color: #0d6efd !important;
    }
</style>
<script>
    // Tab functionality that works with deferred Bootstrap
    document.addEventListener('DOMContentLoaded', function() {
        console.log('DOM loaded, initializing tabs...');
        
        // Wait for Bootstrap to be loaded
        function initTabs() {
            if (typeof bootstrap !== 'undefined' && bootstrap.Tab) {
                console.log('Bootstrap loaded, initializing tabs...');
                
                // Get all tab buttons
                const tabButtons = document.querySelectorAll('#stationTabs button[data-bs-toggle="tab"]');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const targetId = this.getAttribute('data-bs-target');
                        const targetPane = document.querySelector(targetId);
                        
                        if (targetPane) {
                            // Hide all tab panes
                            document.querySelectorAll('.tab-pane').forEach(pane => {
                                pane.classList.remove('show', 'active');
                            });
                            
                            // Remove active class from all tab buttons
                            tabButtons.forEach(btn => {
                                btn.classList.remove('active');
                            });
                            
                            // Show target pane and activate button
                            targetPane.classList.add('show', 'active');
                            this.classList.add('active');
                            
                            // Update aria attributes
                            tabButtons.forEach(btn => {
                                btn.setAttribute('aria-selected', 'false');
                            });
                            this.setAttribute('aria-selected', 'true');
                        }
                    });
                });
                
                // Initialize first tab as active
                const firstTab = document.querySelector('#stationTabs .nav-link.active');
                if (firstTab) {
                    firstTab.click();
                }
            } else {
                // Bootstrap not loaded yet, try again in 100ms
                setTimeout(initTabs, 100);
            }
        }
        
        // Start initialization
        initTabs();
        
        // Fallback in case Bootstrap never loads
        setTimeout(function() {
            if (typeof bootstrap === 'undefined') {
                console.log('Bootstrap not loaded, using fallback tab system');
                
                // Simple fallback tab system
                const tabButtons = document.querySelectorAll('#stationTabs button');
                const tabPanes = document.querySelectorAll('.tab-pane');
                
                tabButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        
                        const targetId = this.getAttribute('data-bs-target');
                        const targetPane = document.querySelector(targetId);
                        
                        if (targetPane) {
                            // Hide all panes
                            tabPanes.forEach(pane => {
                                pane.style.display = 'none';
                                pane.classList.remove('show', 'active');
                            });
                            
                            // Remove active from all buttons
                            tabButtons.forEach(btn => {
                                btn.classList.remove('active');
                            });
                            

                            targetPane.style.display = 'block';
                            targetPane.classList.add('show', 'active');
                            this.classList.add('active');
                        }
                    });
                });
                
                if (tabPanes.length > 0) {
                    tabPanes[0].style.display = 'block';
                }
            }
        }, 2000);
    });
</script>
{% endblock %}